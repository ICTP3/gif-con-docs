name: Discord Notify

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send notification to Discord
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          COMMIT_MESSAGE=$(jq -r '.head_commit.message' $GITHUB_EVENT_PATH)
          COMMIT_AUTHOR=$(jq -r '.head_commit.author.name' $GITHUB_EVENT_PATH)
          REPO_NAME=$(jq -r '.repository.name' $GITHUB_EVENT_PATH)
          COMMIT_URL=$(jq -r '.head_commit.url' $GITHUB_EVENT_PATH)

          # JSONÊú¨Êñá„ÇíÊï¥ÂΩ¢„Åó„Å¶ÈÄÅ‰ø°
          payload=$(jq -n \
            --arg repo "$REPO_NAME" \
            --arg author "$COMMIT_AUTHOR" \
            --arg message "$COMMIT_MESSAGE" \
            --arg url "$COMMIT_URL" \
            '{
              "username": "GitHub Bot",
              "embeds": [{
                "title": "üöÄ New Push Event",
                "description": ("üì¶ Repo: \($repo)\nüßë Author: \($author)\nüí¨ Commit: \($message)\nüîó [View Commit](" + $url + ")"),
                "color": 5814783
              }]
            }')

          curl -H "Content-Type: application/json" \
               -d "$payload" \
               "$WEBHOOK_URL"

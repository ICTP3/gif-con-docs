name: Discord Notify

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send rich notification to Discord
        run: |
          COMMIT_MESSAGE=$(jq -r '.head_commit.message' $GITHUB_EVENT_PATH)
          COMMIT_AUTHOR=$(jq -r '.head_commit.author.name' $GITHUB_EVENT_PATH)
          REPO_NAME=$(jq -r '.repository.name' $GITHUB_EVENT_PATH)
          COMMIT_URL=$(jq -r '.head_commit.url' $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
            -d "{
              \"username\": \"GitHub Bot\",
              \"embeds\": [{
                \"title\": \"ðŸš€ New Push Event\",
                \"description\": \"ðŸ“¦ Repo: ${REPO_NAME}\nðŸ§‘ Author: ${COMMIT_AUTHOR}\nðŸ’¬ Commit: ${COMMIT_MESSAGE}\nðŸ”— [View Commit](${COMMIT_URL})\",
                \"color\": 5814783
              }]
            }" \
            ${{ secrets.DISCORD_WEBHOOK }}
